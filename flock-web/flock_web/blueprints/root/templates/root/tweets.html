{% extends "base.html" %}

{% macro render_pagination(pagination) %}
<nav aria-label="Page navigation">
  <ul class="pagination">
    {%- if pagination.has_prev %}
      <li class="page-item">
      <a class="page-link" href="{{ url_for(endpoint, page=pagination.prev_num, **endpoint_kwargs) }}" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
        <span class="sr-only">Previous</span>
      </a>
    {%- else %}
      <li class="page-item disabled">
        <span class="page-link" aria-label="Previous">
          <span aria-hidden="true">&laquo;</span>
          <span class="sr-only">Previous</span>
        </span>
      </li>
    {%- endif %}

    {%- for page in pagination.iter_pages() %}
    {% if page %}
      {% if page != pagination.page %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for(endpoint, page=page, **endpoint_kwargs) }}">{{ page }}</a>
        </li>
      {% else %}
        <li class="page-item active">
          <span class="page-link">{{ page }}
            <span class="sr-only">(current)</span>
          </span>
        </li>
      {% endif %}
    {% else %}
      <li class="page-item disabled">
        <span class="page-link" aria-label="Ellipsis">
          <span aria-hidden="true">...</span>
          <span class="sr-only">Ellipsis</span>
        </span>
      </li>
    {% endif %}
    {%- endfor %}

    {%- if pagination.has_next %}
      <li class="page-item">
      <a class="page-link" href="{{ url_for(endpoint, page=pagination.next_num, **endpoint_kwargs) }}" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
        <span class="sr-only">Next</span>
      </a>
    {%- else %}
      <li class="page-item disabled">
        <span class="page-link" aria-label="Next">
          <span aria-hidden="true">&raquo;</span>
          <span class="sr-only">Next</span>
        </span>
      </li>
    {%- endif %}
  </ul>
</nav>
{% endmacro %}

{% macro render_features(tweet) %}
<div class="card card-block">
<div class="highlight">
    <pre>
{
{%- for feature_name, feature_values in tweet.features.items() %}
  "<a href="{{ url_for('.feature_info', feature_name=feature_name) }}">{{ feature_name }}</a>": [
    {%- for feature_value in feature_values%}
    "<a href="{{ url_for('.tweets', feature_name=feature_name, feature_value=feature_value) }}">{{ feature_value }}</a>",
    {%- endfor%}
  ]
{%- endfor %}
}</pre>

    <button class="btn btn-secondary btn-sm" type="button" data-toggle="collapse" data-target="#tweet-features-raw-{{ tweet.tweet_id }}" aria-expanded="false" aria-controls="collapseExample">
      Raw data
    </button>
    <div class="collapse" id="tweet-features-raw-{{ tweet.tweet_id }}">
        <pre>{{ tweet.features|tojson(indent=2) }}</pre>
    </div>
</div>
{% endmacro %}

{% macro render_tweets(tweets, lang) %}
{%- for tweet in tweets | reverse %}
  {%- if tweet.label == lang %}
    {{ oembed_tweet(tweet.tweet_id, omit_script=True) }}

    <p>
      <button class="btn btn-secondary btn-sm" type="button" data-toggle="collapse" data-target="#tweet-features-{{ tweet.tweet_id }}" aria-expanded="false" aria-controls="collapseExample">
        Features
      </button>
    </p>
    <div class="collapse" id="tweet-features-{{ tweet.tweet_id }}">
        {{ render_features(tweet) }}
      </div>
    </div>


  {%- endif %}
{%- endfor %}
{% endmacro %}


{% block content %}

There are {{ pagination.total }} tweets.

{{ render_pagination(pagination) }}

<div class="container">
  <div class="row">
    {%- for label in label_names %}
      <div class="col-sm-4">
        <h1>{{ label }}</h1>
        {{ render_tweets(pagination.items, label) }}
      </div>
    {%- endfor %}
  </div>
</div>

{%- for tweet in pagination.items %}
{%- endfor %}

{{ render_pagination(pagination) }}

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
{% endblock %}
